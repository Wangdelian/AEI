mxConstants.SHADOWCOLOR = '#C0C0C0';
var userLevelMarkID = 'LM';
var userName = '管理员用户';
var _dataJsonStr = '[{"F_LevelMarkID":"LM","F_ABName":"总公司","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0001","F_ABName":"上海铁路局","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0001-0001","F_ABName":"上海机务段","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0001-0001-0001","F_ABName":"上海整备场","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0001-0001-0001-CH10","F_ABName":"车号设备1","F_State":"1","F_StateName":"正常","F_Description":"设备地点：西闸楼进段","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0001-0001-0001-CH20","F_ABName":"车号设备2","F_State":"1","F_StateName":"正常","F_Description":"设备地点：西闸楼出段","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0001-0001-0001-CH30","F_ABName":"车号设备3","F_State":"0","F_StateName":"故障","F_Description":"设备地点：东闸楼","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0001-0001-0001-CPS1","F_ABName":"CPS服务器","F_State":"0","F_StateName":"故障","F_Description":"设备地点：上海整备场信息机房-CPU使用率：31.60%-内存使用率：62.50%@5.00G@8.00G-硬盘使用率：C:@69.23%@54.00G@78.00GD:@90.11%@82.00G@91.00G-CPS软件进程：WBCps.exe@1@20180510122200-网络状况：0.00K/s@0.00K/s","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]}]},{"F_LevelMarkID":"LM-0001-0001-0002","F_ABName":"上南整备场","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0001-0001-0002-CH51","F_ABName":"车号设备1","F_State":"1","F_StateName":"正常","F_Description":"设备地点：上海南","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]}]},{"F_LevelMarkID":"LM-0001-0001-0003","F_ABName":"南翔整备场","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0001-0001-0003-CH61","F_ABName":"车号设备1","F_State":"1","F_StateName":"正常","F_Description":"设备地点：西闸楼出段","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0001-0001-0003-CH71","F_ABName":"车号设备2","F_State":"1","F_StateName":"正常","F_Description":"设备地点：西闸楼进段","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0001-0001-0003-CH81","F_ABName":"车号设备3","F_State":"1","F_StateName":"正常","F_Description":"设备地点：东闸楼","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]}]}]}]},{"F_LevelMarkID":"LM-0002","F_ABName":"兰州铁路局","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0002-0002","F_ABName":"嘉峪关机务段","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0002-0002-0001","F_ABName":"嘉峪关本段","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0002-0002-0001-CH01","F_ABName":"车号设备1","F_State":"1","F_StateName":"正常","F_Description":"设备地点：西闸楼","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0002-0002-0001-CH02","F_ABName":"车号设备2","F_State":"1","F_StateName":"正常","F_Description":"设备地点：东闸楼","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0002-0002-0001-CPS1","F_ABName":"CPS服务器","F_State":"1","F_StateName":"正常","F_Description":"设备地点：嘉峪关本段信息机房-CPU使用率：31.60%-内存使用率：62.50%@5.00G@8.00G-硬盘使用率：C:@69.23%@54.00G@78.00GD:@90.11%@82.00G@91.00G-CPS软件进程：WBCps.exe@1@20180510122200-网络状况：0.00K/s@0.00K/s","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]}]}]}]},{"F_LevelMarkID":"LM-0005","F_ABName":"沈阳铁路局","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0005-0003","F_ABName":"苏家屯机务段","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0005-0003-0001","F_ABName":"苏家屯本段","F_State":"","F_StateName":"","F_Description":"","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[{"F_LevelMarkID":"LM-0005-0003-0001-CH01","F_ABName":"车号设备1","F_State":"1","F_StateName":"正常","F_Description":"设备地点：北闸楼进段","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0005-0003-0001-CH02","F_ABName":"车号设备2","F_State":"1","F_StateName":"正常","F_Description":"设备地点：北闸楼出段","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0005-0003-0001-CH03","F_ABName":"车号设备3","F_State":"1","F_StateName":"正常","F_Description":"设备地点：南闸楼出段","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0005-0003-0001-CH04","F_ABName":"车号设备4","F_State":"1","F_StateName":"正常","F_Description":"设备地点：南闸楼进段","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]},{"F_LevelMarkID":"LM-0005-0003-0001-CPS1","F_ABName":"CPS服务器","F_State":"1","F_StateName":"正常","F_Description":"设备地点：苏家屯本段信息机房-CPU使用率：31.60%-内存使用率：62.50%@5.00G@8.00G-硬盘使用率：C:@69.23%@54.00G@78.00GD:@90.11%@82.00G@91.00G-CPS软件进程：WBCps.exe@1@20180510122200-网络状况：0.00K/s@0.00K/s","F_DeviceSerialNumber":"","F_DeviceAttribute":"","F_DeviceName":"","F_DeviceState":"","F_DeviceDescription":"","lstJsonDeviceTreeInfoChildren":[]}]}]}]}]}]';
var datajson;

$(function(){
    getdataJson();
    //setTimeout('main()', 1000);
})

function getdataJson(){
    $.ajax({
        type: "POST",
        url: siteurl + '/sys/levelmark/getdata',
        async: true,
        cache: false,
        dataType: "json",
        contentType: 'application/json;charset=UTF-8',
        success: function(r){
            if(r.code === 0){
                datajson = r.firstlevelList;
                main();
            }else {
                alert(r.msg);
            }
        },
        error: function(r){
        }
    });
}

//定义一个树节点
function TreeNodeShape() { };
//通过分配父类的一个实例到子类原型，来“继承”从父类的所有字段和方法：
TreeNodeShape.prototype = new mxCylinder();
TreeNodeShape.prototype.constructor = TreeNodeShape;
// 定义的上边缘部分的长度
TreeNodeShape.prototype.segment = 20;
// 根据状态显示元素
TreeNodeShape.prototype.apply = function (state) {
    mxCylinder.prototype.apply.apply(this, arguments);
    this.state = state;
};

TreeNodeShape.prototype.redrawPath = function (path, x, y, w, h, isForeground) {
    var graph = this.state.view.graph;
    var hasChildren = graph.model.getOutgoingEdges(this.state.cell).length > 0;

    if (isForeground) {
        if (hasChildren) {
            // 这里使用的是元素范围外边距
            path.moveTo(w / 2, h + this.segment);
            path.lineTo(w / 2, h);
            path.end();
        }
    }
    else {
        path.moveTo(0, 0);
        path.lineTo(w, 0);
        path.lineTo(w, h);
        path.lineTo(0, h);
        path.close();
    }
};

mxCellRenderer.prototype.defaultShapes['treenode'] = TreeNodeShape;

// 自定义元素边框
mxGraphView.prototype.updateFloatingTerminalPoint = function (edge, start, end, source) {
    var pt = null;

    if (source) {
        pt = new mxPoint(start.x + start.width / 2,
            start.y + start.height + TreeNodeShape.prototype.segment);
    }
    else {
        pt = new mxPoint(start.x + start.width / 2, start.y);
    }

    edge.setAbsoluteTerminalPoint(pt, source);
};




function main() {
    // 检查浏览器支持
    if (!mxClient.isBrowserSupported()) {
        mxUtils.error('当前浏览器不支持显示！', 200, false);
    }
    else {
        // 定义展开和折叠图标
        mxGraph.prototype.collapsedImage = new mxImage(mxClient.imageBasePath + '/collapsed.gif', 15, 15);
        mxGraph.prototype.expandedImage = new mxImage(mxClient.imageBasePath + '/expanded.gif', 15, 15);
        // 定义容器
        var container = document.getElementById('graphContainer');
        var outline = document.getElementById('outlineContainer');
        //
        if (mxClient.IS_QUIRKS) {
            document.body.style.overflow = 'hidden';
            new mxDivResizer(container);
            new mxDivResizer(outline);
        }
        // 设置渐变的背景  针对不同浏览器
        if (mxClient.IS_GC || mxClient.IS_SF) {
            container.style.background = '-webkit-gradient(linear, 0% 0%, 0% 100%, from(#FFFFFF), to(#E7E7E7))';
        }
        else if (mxClient.IS_NS) {
            container.style.background = '-moz-linear-gradient(top, #FFFFFF, #E7E7E7)';
        }
        else if (mxClient.IS_IE) {
            container.style.filter = 'progid:DXImageTransform.Microsoft.Gradient(' +
                'StartColorStr=\'#FFFFFF\', EndColorStr=\'#E7E7E7\', GradientType=0)';
        }
        //  禁用浏览器默认的右键菜单栏
        mxEvent.disableContextMenu(container);
        // 在容器中创建图形
        var graph = new mxGraph(container);

        // 设置连线在最底层
        graph.keepEdgesInBackground = true;
        // 元素是否移动
        graph.setCellsMovable(false);
        // 设置不能摇晃连线
        graph.setAllowDanglingEdges(false);
        // 设置自动调整大小
        graph.setAutoSizeCells(false);
        // 右键移动容器坐标轴


        graph.setPanning(true);
        graph.centerZoom = true;
        graph.panningHandler.useLeftButtonForPanning = true;
        graph.panningHandler.popupMenuHandler = false;


        // 创建大纲显示
        var outln = new mxOutline(graph, outline);

        var style = graph.getStylesheet().getDefaultVertexStyle();
        style[mxConstants.STYLE_SHAPE] = 'label';

        style[mxConstants.STYLE_VERTICAL_ALIGN] = mxConstants.ALIGN_MIDDLE;
        style[mxConstants.STYLE_ALIGN] = mxConstants.ALIGN_LEFT;
        style[mxConstants.STYLE_SPACING_TOP] = 0;
        style[mxConstants.STYLE_SPACING_LEFT] = 38;

        style[mxConstants.STYLE_GRADIENTCOLOR] = '#7d85df';
        style[mxConstants.STYLE_STROKECOLOR] = '#5d65df';
        style[mxConstants.STYLE_FILLCOLOR] = '#abc5ff';

        style[mxConstants.STYLE_FONTCOLOR] = '#1d258f';
        style[mxConstants.STYLE_FONTFAMILY] = 'Verdana';
        style[mxConstants.STYLE_FONTSIZE] = '12';
        style[mxConstants.STYLE_FONTSTYLE] = '1';

        style[mxConstants.STYLE_SHADOW] = '1';
        style[mxConstants.STYLE_ROUNDED] = '1';
        style[mxConstants.STYLE_GLASS] = '1';

        style[mxConstants.STYLE_IMAGE] = siteurl+'/public/plugins/operation/images/company.png';
        style[mxConstants.STYLE_IMAGE_WIDTH] = '32';
        style[mxConstants.STYLE_IMAGE_HEIGHT] = '32';
        style[mxConstants.STYLE_SPACING] = 8;


        style = graph.getStylesheet().getDefaultEdgeStyle();
        style[mxConstants.STYLE_ROUNDED] = true;
        style[mxConstants.STYLE_STROKEWIDTH] = 3;
        style[mxConstants.STYLE_EXIT_X] = 0.5; // center
        style[mxConstants.STYLE_EXIT_Y] = 1.0; // bottom
        style[mxConstants.STYLE_EXIT_PERIMETER] = 0; // disabled
        style[mxConstants.STYLE_ENTRY_X] = 0.5; // center
        style[mxConstants.STYLE_ENTRY_Y] = 0; // top
        style[mxConstants.STYLE_ENTRY_PERIMETER] = 0; // disabled

        // 禁用以下几个为直线
        style[mxConstants.STYLE_EDGE] = mxEdgeStyle.TopToBottom;
        // 按下回车或者Tab 键停止编辑
        var keyHandler = new mxKeyHandler(graph);

        // 在树布局中添加子元素的更新、添加、删除监听程序
        var layout = new mxCompactTreeLayout(graph, false);
        layout.useBoundingBox = false;
        layout.edgeRouting = false;
        layout.levelDistance = 30;
        layout.nodeDistance = 10;

        // 启用元素向下移动
        layout.isVertexMovable = function (cell) {
            return true;
        };

        var layoutMgr = new mxLayoutManager(graph);

        layoutMgr.getLayout = function (cell) {
            if (cell.getChildCount() > 0) {
                return layout;
            }
        };

        // 创建右键下拉菜单
        graph.popupMenuHandler.factoryMethod = function (menu, cell, evt) {
            return createPopupMenu(graph, menu, cell, evt);
        };

        // 修正首选大小的错误
        var oldGetPreferredSizeForCell = graph.getPreferredSizeForCell;
        graph.getPreferredSizeForCell = function (cell) {
            var result = oldGetPreferredSizeForCell.apply(this, arguments);

            if (result != null) {
                //result.width = Math.max(120, result.width - 40);
                result.width = 130;
            }

            return result;
        };

        // Sets the maximum text scale to 1
        graph.cellRenderer.getTextScale = function (state) {
            return Math.min(1, state.view.scale);
        };

        // Dynamically adds text to the label as we zoom in
        // (without affecting the preferred size for new cells)
        graph.cellRenderer.getLabelValue = function (state) {
            var result = state.cell.value;

            if (state.view.graph.getModel().isVertex(state.cell)) {
                if (state.view.scale > 1) {
                    //result += '\nDetails 1';
                }

                if (state.view.scale > 1.3) {
                    //result += '\nDetails 2';
                }
            }

            return result;
        };

        // 禁用菜单操作
        //graph.setCellsSelectable(true);

        // 定义折叠功能
        graph.isCellFoldable = function (cell) {
            return this.model.getOutgoingEdges(cell).length > 0;
        };

        // 定义折叠图标位置
        graph.cellRenderer.getControlBounds = function (state) {
            if (state.control != null) {
                var oldScale = state.control.scale;
                var w = state.control.bounds.width / oldScale;
                var h = state.control.bounds.height / oldScale;
                var s = state.view.scale;

                return new mxRectangle(state.x + state.width / 2 - w / 2 * s,
                    state.y + state.height + TreeNodeShape.prototype.segment * s - h / 2 * s,
                    w * s, h * s);
            }

            return null;
        };

        // 覆写折叠函数
        graph.foldCells = function (collapse, recurse, cells) {
            this.model.beginUpdate();
            try {
                toggleSubtree(this, cells[0], !collapse);
                this.model.setCollapsed(cells[0], collapse);

                // 执行折叠操作
                layout.execute(graph.getDefaultParent());
            }
            finally {
                this.model.endUpdate();
            }
        };

        // 创建默认窗体
        var parent = graph.getDefaultParent();

        //截去的标签内多余的文字（只显示标签宽度内的文字）
        graph.getLabel = function (cell) {
            var label = (this.labelsVisible) ? this.convertValueToString(cell) : '';
            var geometry = this.model.getGeometry(cell);

            if (!this.model.isCollapsed(cell) && geometry != null && (geometry.offset == null ||
                (geometry.offset.x == 0 && geometry.offset.y == 0)) && this.model.isVertex(cell) &&
                geometry.width >= 2) {
                var style = this.getCellStyle(cell);
                var fontSize = style[mxConstants.STYLE_FONTSIZE] || mxConstants.DEFAULT_FONTSIZE;
                var max = geometry.width / (fontSize * 0.625);

                if (max < label.length) {
                    return label.substring(0, max) + '...';
                }
            }

            return label;
        };

        // 是否折叠
        graph.isWrapping = function (cell) {
            return this.model.isCollapsed(cell);
        };

        // 标签是否被裁剪
        graph.isLabelClipped = function (cell) {
            var geometry = this.model.getGeometry(cell);

            return geometry != null && !geometry.relative && (geometry.offset == null ||
                (geometry.offset.x == 0 && geometry.offset.y == 0));
        };

        //refreshGraph(graph,_dataJsonStr);
        // 开始更新事务
        graph.getModel().beginUpdate();
        try {
            var w = graph.container.offsetWidth;
            //var _dataJson = eval('(' + _dataJsonStr + ')');

            var _dataJson = datajson;
            /*console.log("现在得")
            console.log(_dataJson)
            console.log(_dataJson.length)*/

            //根节点
            if (_dataJson!=null&&_dataJson.length > 0) {
                //alert(_dataJson.length);//获取子节点大小
                for (var a = 0; a < _dataJson.length; a++) {
                    var LevelMarkID = _dataJson[a].f_LevelMarkID;
                    var ABName = _dataJson[a].f_ABName;
                    var State = _dataJson[a].f_State;
                    var StateName = _dataJson[a].f_StateName;
                    var Description = _dataJson[a].f_DeviceDescription;
                    var DeviceName = _dataJson[a].f_DeviceName;
                    var DeviceSerialNumber = _dataJson[a].f_DeviceSerialNumber;
                    var DeviceAttribute = _dataJson[a].f_DeviceAttribute;
                    var DeviceState = _dataJson[a].f_DeviceState;
                    var DeviceDescription = _dataJson[a].f_DeviceDescription;
                    //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                    if (DeviceName == ""||DeviceName == null) {
                        if (ABName.indexOf("车号") != -1) {
                            if (State == 0) {
                                var Root = graph.insertVertex(parent, 'Root', ABName, w / 2 - 30, 20, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Root]);
                                graph.updateCellSize(Root);
                                addOverlaysInfo(graph, Root, 2, ABName, Description);
                                var RootLabel = graph.insertVertex(Root, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                            }
                            else if (State == 1) {
                                var Root = graph.insertVertex(parent, 'Root', ABName, w / 2 - 30, 20, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                graph.updateCellSize(Root);
                                addOverlaysInfo(graph, Root, 1, ABName, Description);
                                var RootLabel = graph.insertVertex(Root, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                            }
                        }
                        else if (ABName.indexOf("CPS") != -1) {//CPS信息
                            if (State == 0) {
                                var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Root]);
                                graph.updateCellSize(Root);
                                addOverlaysInfo(graph, Root, 2, ABName, Description);
                                var RootLabel = graph.insertVertex(Root, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                            }
                            else if (State == 1) {
                                var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                graph.updateCellSize(Root);
                                addOverlaysInfo(graph, Root, 1, ABName, Description);
                                var RootLabel = graph.insertVertex(Root, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                            }
                        }
                        else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                            continue;
                            var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                            graph.updateCellSize(Root);
                        }
                        else if (ABName.indexOf("天线") != -1) {//天线信息
                            continue;
                            var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Ant.png');
                            graph.updateCellSize(Root);
                        }
                        else if (ABName.indexOf("灯光") != -1) {//灯光信息
                            continue;
                            var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Light.png');
                            graph.updateCellSize(Root);
                        }
                        else if (ABName.indexOf("相机") != -1) {//相机信息
                            continue;
                            var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                            graph.updateCellSize(Root);
                        }
                        else {
                            var Root = graph.insertVertex(parent, 'Root', ABName, w / 2 - 30, 20, 130, 80);
                            graph.updateCellSize(Root);
                        }
                    }
                    else {
                    }
                    //下1级
                    if (_dataJson[a].lstJsonDeviceTreeInfoChildren!=null&&_dataJson[a].lstJsonDeviceTreeInfoChildren.length > 0) {
                        //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren.length);//获取子节点大小
                        for (var b = 0; b < _dataJson[a].lstJsonDeviceTreeInfoChildren.length; b++) {
                            LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_LevelMarkID;
                            ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_ABName;
                            State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_State;
                            StateName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_StateName;
                            Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_Description;
                            DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_DeviceName;
                            DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_DeviceSerialNumber;
                            DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_DeviceAttribute;
                            DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_DeviceState;
                            DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].f_DeviceDescription;
                            //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                            if (DeviceName == ""||DeviceName == null) {
                                if (ABName.indexOf("车号") != -1) {
                                    if (State == 0) {
                                        var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                        graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child1]);
                                        graph.updateCellSize(Child1);
                                        addOverlaysInfo(graph, Child1, 2, ABName, Description);
                                        var RootLabel = graph.insertVertex(Child1, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                    }
                                    else if (State == 1) {
                                        var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                        graph.updateCellSize(Child1);
                                        addOverlaysInfo(graph, Child1, 1, ABName, Description);
                                        var RootLabel = graph.insertVertex(Child1, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                    }
                                }
                                else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                    if (State == 0) {
                                        var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                        graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child1]);
                                        graph.updateCellSize(Child1);
                                        addOverlaysInfo(graph, Child1, 2, ABName, Description);
                                        var RootLabel = graph.insertVertex(Child1, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                    }
                                    else if (State == 1) {
                                        var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                        graph.updateCellSize(Child1);
                                        addOverlaysInfo(graph, Child1, 1, ABName, Description);
                                        var RootLabel = graph.insertVertex(Child1, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                    }
                                }
                                else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                    continue;
                                    var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                    graph.updateCellSize(Child1);
                                }
                                else if (ABName.indexOf("天线") != -1) {//天线信息
                                    continue;
                                    var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                                    graph.updateCellSize(Child1);
                                }
                                else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                    continue;
                                    var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Light.png');
                                    graph.updateCellSize(Child1);
                                }
                                else if (ABName.indexOf("相机") != -1) {//相机信息
                                    continue;
                                    var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                                    graph.updateCellSize(Child1);
                                }
                                else {
                                    var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80);
                                    graph.updateCellSize(Child1);
                                }
                            }
                            else {
                            }
                            graph.insertEdge(parent, null, '', Root, Child1);//添加连线
                            //下2级
                            if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren!=null&&_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren.length) {
                                //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren.length);//获取子节点大小
                                for (var c = 0; c < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren.length; c++) {
                                    LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_LevelMarkID;
                                    ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_ABName;
                                    State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_State;//状态
                                    StateName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_StateName;
                                    Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_Description;//描述
                                    DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_DeviceName;
                                    DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_DeviceSerialNumber;
                                    DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_DeviceAttribute;
                                    DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_DeviceState;
                                    DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].f_DeviceDescription;
                                    //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                                    if (DeviceName == ""||DeviceName == null) {
                                        if (ABName.indexOf("车号") != -1) {
                                            if (State == 0) {
                                                var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child2]);
                                                graph.updateCellSize(Child2);
                                                addOverlaysInfo(graph, Child2, 2, ABName, Description);
                                                var RootLabel = graph.insertVertex(Child2, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                            }
                                            else if (State == 1) {
                                                var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                graph.updateCellSize(Child2);
                                                addOverlaysInfo(graph, Child2, 1, ABName, Description);
                                                var RootLabel = graph.insertVertex(Child2, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                            }
                                        }
                                        else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                            if (State == 0) {
                                                var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child2]);
                                                graph.updateCellSize(Child2);
                                                addOverlaysInfo(graph, Child2, 2, ABName, Description);
                                                var RootLabel = graph.insertVertex(Child2, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                            }
                                            else if (State == 1) {
                                                var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                graph.updateCellSize(Child3);
                                                addOverlaysInfo(graph, Child2, 1, ABName, Description);
                                                var RootLabel = graph.insertVertex(Child2, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                            }
                                        }
                                        else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                            continue;
                                            var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                            graph.updateCellSize(Child2);
                                        }
                                        else if (ABName.indexOf("天线") != -1) {//天线信息
                                            continue;
                                            var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                                            graph.updateCellSize(Child2);
                                        }
                                        else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                            continue;
                                            var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Light.png');
                                            graph.updateCellSize(Child2);
                                        }
                                        else if (ABName.indexOf("相机") != -1) {//相机信息
                                            continue;
                                            var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                                            graph.updateCellSize(Child2);
                                        }
                                        else {
                                            var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80);
                                            graph.updateCellSize(Child2);
                                        }
                                    }
                                    else {
                                    }
                                    graph.insertEdge(parent, null, '', Child1, Child2);//添加连线
                                    //下3级
                                    if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren!=null&&_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren.length) {

                                        //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren.length);
                                        for (var d = 0; d < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren.length; d++) {
                                            LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_LevelMarkID;
                                            ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_ABName;
                                            State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_State;
                                            StateName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_StateName;
                                            Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_Description;
                                            DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_DeviceName;
                                            DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_DeviceSerialNumber;
                                            DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_DeviceAttribute;
                                            DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_DeviceState;
                                            DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].f_DeviceDescription;
                                            //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);
                                            if (DeviceName == ""||DeviceName == null) {
                                                if (ABName.indexOf("车号") != -1) {//AEI信息
                                                    if (State == 0) {
                                                        var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                        graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child3]);
                                                        graph.updateCellSize(Child3);
                                                        addOverlaysInfo(graph, Child3, 2, ABName, Description);
                                                        var RootLabel = graph.insertVertex(Child3, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                    }
                                                    else if (State == 1) {
                                                        var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                        graph.updateCellSize(Child3);
                                                        addOverlaysInfo(graph, Child3, 1, ABName, Description);
                                                        var RootLabel = graph.insertVertex(Child3, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                    }
                                                }
                                                else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                                    if (State == 0) {
                                                        var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                        graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child3]);
                                                        graph.updateCellSize(Child3);
                                                        addOverlaysInfo(graph, Child3, 2, ABName, Description);
                                                        var RootLabel = graph.insertVertex(Child3, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                    }
                                                    else if (State == 1) {
                                                        var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                        graph.updateCellSize(Child3);
                                                        addOverlaysInfo(graph, Child3, 1, ABName, Description);
                                                        var RootLabel = graph.insertVertex(Child3, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                    }
                                                }
                                                else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                                    continue;
                                                    var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                                    graph.updateCellSize(Child3);
                                                }
                                                else if (ABName.indexOf("天线") != -1) {//天线信息
                                                    continue;
                                                    var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                                                    graph.updateCellSize(Child3);
                                                }
                                                else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                                    continue;
                                                    var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Light.png');
                                                    graph.updateCellSize(Child3);
                                                }
                                                else if (ABName.indexOf("相机") != -1) {//相机信息
                                                    continue;
                                                    var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                                                    graph.updateCellSize(Child3);
                                                }
                                                else {
                                                    var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80);
                                                    graph.updateCellSize(Child3);
                                                }
                                            }
                                            else {
                                            }
                                            graph.insertEdge(parent, null, '', Child2, Child3);//添加连线
                                            //下4级
                                            if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren!=null&&_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren.length) {
                                                //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren.length);
                                                for (var e = 0; e < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren.length; e++) {
                                                    LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_LevelMarkID;
                                                    ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_ABName;
                                                    State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_State;
                                                    StateName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_StateName;
                                                    Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_Description;
                                                    DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_DeviceName;
                                                    DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_DeviceSerialNumber;
                                                    DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_DeviceAttribute;
                                                    DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_DeviceState;
                                                    DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].f_DeviceDescription;
                                                    //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);
                                                    if (DeviceName == ""||DeviceName == null) {
                                                        if (ABName.indexOf("车号") != -1) {//AEI信息
                                                            if (State == 0) {
                                                                var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                                graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child4]);
                                                                graph.updateCellSize(Child4);
                                                                addOverlaysInfo(graph, Child4, 2, ABName, Description);
                                                                var RootLabel = graph.insertVertex(Child4, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                            }
                                                            else if (State == 1) {
                                                                var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                                graph.updateCellSize(Child4);
                                                                addOverlaysInfo(graph, Child4, 1, ABName, Description);
                                                                var RootLabel = graph.insertVertex(Child4, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                            }
                                                        }
                                                        else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                                            if (State == 0) {
                                                                var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                                graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child4]);
                                                                graph.updateCellSize(Child4);
                                                                addOverlaysInfo(graph, Child4, 2, ABName, Description);
                                                                var RootLabel = graph.insertVertex(Child4, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                            }
                                                            else if (State == 1) {
                                                                var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                                graph.updateCellSize(Child4);
                                                                addOverlaysInfo(graph, Child4, 1, ABName, Description);
                                                                var RootLabel = graph.insertVertex(Child4, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                            }
                                                        }
                                                        else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                                            continue;
                                                            var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                                            graph.updateCellSize(Child4);
                                                        }
                                                        else if (ABName.indexOf("天线") != -1) {//天线信息
                                                            continue;
                                                            var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                                                            graph.updateCellSize(Child4);
                                                        }
                                                        else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                                            continue;
                                                            var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Light.png');
                                                            graph.updateCellSize(Child4);
                                                        }
                                                        else if (ABName.indexOf("相机") != -1) {//相机信息
                                                            continue;
                                                            var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                                                            graph.updateCellSize(Child4);
                                                        }
                                                        else {
                                                            var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80);
                                                            graph.updateCellSize(Child4);
                                                        }
                                                    }
                                                    else {

                                                    }
                                                    graph.insertEdge(parent, null, '', Child3, Child4);//添加连线
                                                    //下5级
                                                    if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren!=null&&_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren.length) {
                                                        //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren.length);
                                                        for (var f = 0; f < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren.length; f++) {
                                                            LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_LevelMarkID;
                                                            ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_ABName;
                                                            State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_State;
                                                            StateName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_StateName;
                                                            Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_Description;
                                                            DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_DeviceName;
                                                            DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_DeviceSerialNumber;
                                                            DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_DeviceAttribute;
                                                            DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_DeviceState;
                                                            DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].f_DeviceDescription;
                                                            //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                                                            if (DeviceName == ""||DeviceName == null) {
                                                                if (ABName.indexOf("车号") != -1) {//AEI信息
                                                                    if (State == 0) {
                                                                        var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                                        graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child5]);
                                                                        graph.updateCellSize(Child5);
                                                                        addOverlaysInfo(graph, Child5, 2, ABName, Description);
                                                                        var RootLabel = graph.insertVertex(Child5, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                                    }
                                                                    else if (State == 1) {
                                                                        var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                                        graph.updateCellSize(Child5);
                                                                        addOverlaysInfo(graph, Child5, 1, ABName, Description);
                                                                        var RootLabel = graph.insertVertex(Child5, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                                    }
                                                                }
                                                                else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                                                    if (State == 0) {
                                                                        var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                                        graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child5]);
                                                                        graph.updateCellSize(Child5);
                                                                        addOverlaysInfo(graph, Child5, 2, ABName, Description);
                                                                        var RootLabel = graph.insertVertex(Child5, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                                    }
                                                                    else if (State == 1) {
                                                                        var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                                        graph.updateCellSize(Child5);
                                                                        addOverlaysInfo(graph, Child5, 1, ABName, Description);
                                                                        var RootLabel = graph.insertVertex(Child5, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                                    }
                                                                }
                                                                else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                                                    continue;
                                                                    var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                                                    graph.updateCellSize(Child5);
                                                                }
                                                                else if (ABName.indexOf("天线") != -1) {//天线信息
                                                                    continue;
                                                                    var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                                                                    graph.updateCellSize(Child5);
                                                                }
                                                                else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                                                    continue;
                                                                    var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Light.png');
                                                                    graph.updateCellSize(Child5);
                                                                }
                                                                else if (ABName.indexOf("相机") != -1) {//相机信息
                                                                    continue;
                                                                    var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                                                                    graph.updateCellSize(Child5);
                                                                }
                                                                else {
                                                                    var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80);
                                                                    graph.updateCellSize(Child5);
                                                                }
                                                            }
                                                            else {

                                                            }
                                                            graph.insertEdge(parent, null, '', Child4, Child5);//添加连线
                                                            //下6级
                                                            if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren!=null&&_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren.length) {
                                                                //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren.length);
                                                                for (var g = 0; g < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren.length; g++) {
                                                                    LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_LevelMarkID;
                                                                    ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_ABName;
                                                                    State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_State;
                                                                    StateName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_StateName;
                                                                    Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_Description;
                                                                    DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_DeviceName;
                                                                    DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_DeviceSerialNumber;
                                                                    DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_DeviceAttribute;
                                                                    DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_DeviceState;
                                                                    DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g].f_DeviceDescription;
                                                                    //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                                                                    if (DeviceName == ""||DeviceName == null) {
                                                                        if (ABName.indexOf("车号") != -1) {//AEI信息
                                                                            if (State == 0) {
                                                                                var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/AEI.png');
                                                                                graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child5]);
                                                                                graph.updateCellSize(Child6);
                                                                                addOverlaysInfo(graph, Child6, 2, ABName, Description);
                                                                                var RootLabel = graph.insertVertex(Child6, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                                            }
                                                                            else if (State == 1) {
                                                                                var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/AEI.png');
                                                                                graph.updateCellSize(Child6);
                                                                                addOverlaysInfo(graph, Child6, 1, ABName, Description);
                                                                                var RootLabel = graph.insertVertex(Child6, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                                            }
                                                                        }
                                                                        else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                                                            if (State == 0) {
                                                                                var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/CPS.png');
                                                                                graph.setCellStyles(mxConstants.STYLE_FILLCOLOR, "#FF0033", [Child6]);
                                                                                graph.updateCellSize(Child6);
                                                                                addOverlaysInfo(graph, Child6, 2, ABName, Description);
                                                                                var RootLabel = graph.insertVertex(Child2, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                                            }
                                                                            else if (State == 1) {
                                                                                var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/CPS.png');
                                                                                graph.updateCellSize(Child6);
                                                                                addOverlaysInfo(graph, Child6, 1, ABName, Description);
                                                                                var RootLabel = graph.insertVertex(Child2, null, '状态：' + StateName, 0, 0.9, 0, 0, null, true);
                                                                            }
                                                                        }
                                                                        else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                                                            continue;
                                                                            var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Mag.png');
                                                                            graph.updateCellSize(Child6);
                                                                        }
                                                                        else if (ABName.indexOf("天线") != -1) {//天线信息
                                                                            continue;
                                                                            var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Ant.png');
                                                                            graph.updateCellSize(Child6);
                                                                        }
                                                                        else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                                                            continue;
                                                                            var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Light.png');
                                                                            graph.updateCellSize(Child6);
                                                                        }
                                                                        else if (ABName.indexOf("相机") != -1) {//相机信息
                                                                            continue;
                                                                            var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Camera.png');
                                                                            graph.updateCellSize(Child6);
                                                                        }
                                                                        else {
                                                                            var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80);
                                                                            graph.updateCellSize(Child6);
                                                                        }
                                                                    }
                                                                    else {

                                                                    }
                                                                    graph.insertEdge(parent, null, '', Child5, Child6);//添加连线
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }

                }
            }
        }
        finally {
            // 结束更新事务
            graph.getModel().endUpdate();
            if (userLevelMarkID == "") {

            }
            //alert(userLevelMarkID);
            graph.fit();//合适大小

            //设定图形缩小的最值
             //graph.minimumGraphSize(10,10);
            //graph.zoomActual();//实际大小
            //graph.centerZoom();
            //graph.minimumContainerSize(100,200);

        }

        // 添加工具栏
        var content = document.createElement('div');
        content.style.padding = '4px';
        // 通过分配父类的一个实例到子类原型，来“继承”从父类的所有字段和方法
        var tb = new mxToolbar(content);


        //定义一个变量控制放大缩小的次数
        var count=3;

        tb.addItem('放大', siteurl+'/public/plugins/operation/images/zoom_in32.png', function (evt) {
            if(count>0){
            graph.zoomIn();
            count=count-1;
            }else {
                return;
            }

        });

        tb.addItem('缩小', siteurl+'/public/plugins/operation/images/zoom_out32.png', function (evt) {
            if(count<6) {

                graph.zoomOut();
                count=count+1;
            }else {
                return;
            }



        });

        tb.addItem('原始', siteurl+'/public/plugins/operation/images/view_1_132.png', function (evt) {
            graph.zoomActual();
        });

        tb.addItem('打印', siteurl+'/public/plugins/operation/images/print32.png', function (evt) {
            var preview = new mxPrintPreview(graph, 1);
            preview.open();
        });

        tb.addItem('海报打印', siteurl+'/public/plugins/operation/images/press32.png', function (evt) {
            var pageCount = mxUtils.prompt('输入最大页数', '1');

            if (pageCount != null) {
                var scale = mxUtils.getScaleForPageCount(pageCount, graph);
                var preview = new mxPrintPreview(graph, scale);
                preview.open();
            }
        });

        wnd = new mxWindow('工具栏', content, 0, 0, 200, 66);
        wnd.setMaximizable(false);
        wnd.setScrollable(false);
        wnd.setResizable(false);
        wnd.setVisible(true);
    }

    /*document.getElementById('ereload').style.display = 'block';
    eReloadInit(); //
    setInterval("refreshEReloadData()", 5000);//定时刷新换装数据 20s*/
};

// 创建右键点击菜单
function createPopupMenu(graph, menu, cell, evt) {
    var model = graph.getModel();
    if (cell != null) {
        if (model.isVertex(cell)) {
            menu.addItem('添加', '/Media/skin1/mxgraph/examples/editors/images/overlays/check.png', function () {
                addChild(graph, cell);
            });
        }

        menu.addItem('编辑', '/Media/skin1/mxgraph/examples/editors/images/text.gif', function () {
            graph.startEditingAtCell(cell);
        });

        if (cell.id != 'treeRoot' &&
            model.isVertex(cell)) {
            menu.addItem('删除', '/Media/skin1/mxgraph/examples/editors/images/delete.gif', function () {
                deleteSubtree(graph, cell);
            });
        }

        menu.addSeparator();
    }

    menu.addItem('合适大小', '/Media/skin1/mxgraph/examples/editors/images/zoom.gif', function () {
        graph.fit();
    });

    menu.addItem('实际大小', '/Media/skin1/mxgraph/examples/editors/images/zoomactual.gif', function () {
        graph.zoomActual();
    });

    menu.addSeparator();

    menu.addItem('打印', '/Media/skin1/mxgraph/examples/editors/images/print.gif', function () {
        var preview = new mxPrintPreview(graph, 1);
        preview.open();
    });

    menu.addItem('海报打印', '/Media/skin1/mxgraph/examples/editors/images/print.gif', function () {
        var pageCount = mxUtils.prompt('输入最大页数', '1');

        if (pageCount != null) {
            var scale = mxUtils.getScaleForPageCount(pageCount, graph);
            var preview = new mxPrintPreview(graph, scale);
            preview.open();
        }
    });
};

//
function addOverlaysInfo(graph, cell, type, deviceName, deviceDescription) {
    //if (type == '1') {//基本
    //    var overlay = new mxCellOverlay(new mxImage('/Media/skin1/mxgraph/src/images/information.png', 32, 32), '查看详细信息');
    //    overlay.cursor = 'hand';
    //    //overlay.align = mxConstants.ALIGN_RIGHT;
    //    overlay.offset = new mxPoint(0, -64);
    //    overlay.addListener(mxEvent.CLICK, mxUtils.bind(this, function (sender, evt) {
    //        //addChild(graph, cell);
    //        var strinfo = deviceDescription.split('-');
    //        var str = "【" + deviceName + "】信息======\n";
    //        for (var i = 0; i < strinfo.length; i++) {
    //            str += strinfo[i];
    //            str += "\n";
    //        }
    //        alert(str);
    //    }));

    //    graph.addCellOverlay(cell, overlay);
    //}
    //else if (type == '2') {//警告
    //    //graph.style[mxConstants.STYLE_FILLCOLOR] = '#0005ff';
    //    var overlay = new mxCellOverlay(new mxImage('/Media/skin1/mxgraph/src/images/warning.png', 32, 32), '查看详细信息');
    //    overlay.cursor = 'hand';
    //    //overlay.align = mxConstants.ALIGN_RIGHT;
    //    overlay.offset = new mxPoint(0, -64);
    //    overlay.addListener(mxEvent.CLICK, mxUtils.bind(this, function (sender, evt) {
    //        //addChild(graph, cell);
    //        var strinfo = deviceDescription.split('-');
    //        var str = "【" + deviceName + "】警告======\n";
    //        for (var i = 0; i < strinfo.length; i++) {
    //            str += strinfo[i];
    //            str += "\n";
    //        }
    //        alert(str);
    //    }));

    //    graph.addCellOverlay(cell, overlay);
    //}
    //else if (type == '3') {//询问
    //    var overlay = new mxCellOverlay(new mxImage('/Media/skin1/mxgraph/src/images/question.png', 32, 32), '查看详细信息');
    //    overlay.cursor = 'hand';
    //    //overlay.align = mxConstants.ALIGN_RIGHT;
    //    overlay.offset = new mxPoint(0, -64);
    //    overlay.addListener(mxEvent.CLICK, mxUtils.bind(this, function (sender, evt) {
    //        //addChild(graph, cell);
    //        alert("question！");
    //    }));

    //    graph.addCellOverlay(cell, overlay);
    //}
};

function addOverlays(graph, cell, addDeleteIcon) {
    var overlay = new mxCellOverlay(new mxImage('/Media/skin1/mxgraph/examples/images/add.png', 24, 24), 'Add child');
    overlay.cursor = 'hand';
    overlay.align = mxConstants.ALIGN_CENTER;
    overlay.addListener(mxEvent.CLICK, mxUtils.bind(this, function (sender, evt) {
        addChild(graph, cell);
    }));

    graph.addCellOverlay(cell, overlay);

    if (addDeleteIcon) {
        overlay = new mxCellOverlay(new mxImage('/Media/skin1/mxgraph/examples/images/close.png', 30, 30), 'Delete');
        overlay.cursor = 'hand';
        overlay.offset = new mxPoint(-4, 8);
        overlay.align = mxConstants.ALIGN_RIGHT;
        overlay.verticalAlign = mxConstants.ALIGN_TOP;
        overlay.addListener(mxEvent.CLICK, mxUtils.bind(this, function (sender, evt) {
            deleteSubtree(graph, cell);
        }));

        graph.addCellOverlay(cell, overlay);
    }
};

function addChild(graph, cell) {
    var model = graph.getModel();
    var parent = graph.getDefaultParent();
    var vertex;

    model.beginUpdate();
    try {
        vertex = graph.insertVertex(parent, null, 'Double click to set name');
        var geometry = model.getGeometry(vertex);

        // Updates the geometry of the vertex with the
        // preferred size computed in the graph
        var size = graph.getPreferredSizeForCell(vertex);
        geometry.width = size.width;
        geometry.height = size.height;

        // Adds the edge between the existing cell
        // and the new vertex and executes the
        // automatic layout on the parent
        var edge = graph.insertEdge(parent, null, '', cell, vertex);

        // Configures the edge label "in-place" to reside
        // at the end of the edge (x = 1) and with an offset
        // of 20 pixels in negative, vertical direction.
        edge.geometry.x = 1;
        edge.geometry.y = 0;
        edge.geometry.offset = new mxPoint(0, -20);


        //self.location.href= siteurl + '/sys/levelmark/addchild?'


        //addOverlays(graph, vertex, true);
    }
    finally {

        model.endUpdate();
        /*console.log("------");
        console.log(model);
        console.log(parent);*/
        var objid = model.nextId
        var parentname = parent.children[objid].source.value;
        var objname = parent.children[objid].target.value;

    }

    return vertex;
};

function deleteSubtree(graph, cell) {
    // Gets the subtree from cell downwards
    var cells = [];
    graph.traverse(cell, true, function (vertex) {
        cells.push(vertex);

        return true;
    });

    graph.removeCells(cells);
};

// 元素展开折叠遍历子元素
function toggleSubtree(graph, cell, show) {
    show = (show != null) ? show : true;
    var cells = [];

    graph.traverse(cell, true, function (vertex) {
        if (vertex != cell) {
            cells.push(vertex);
        }

        // 停止递归，如果元素被删除
        return vertex == cell || !graph.isCellCollapsed(vertex);
    });

    graph.toggleCells(show, cells, true);
};

function refreshGraph(graph, _dataJsonStr) {
    // 开始更新事务
    graph.getModel().beginUpdate();
    try {
        var w = graph.container.offsetWidth;
        var _dataJson = eval('(' + _dataJsonStr + ')');
        //根节点
        if (_dataJson.length > 0) {
            //alert(_dataJson.length);//获取子节点大小
            for (var a = 0; a < _dataJson.length; a++) {
                var LevelMarkID = _dataJson[a]["F_LevelMarkID"];
                var ABName = _dataJson[a]["F_ABName"];
                var State = _dataJson[a]["F_State"];
                var Description = _dataJson[a]["F_Description"];
                var DeviceName = _dataJson[a]["F_DeviceName"];
                var DeviceSerialNumber = _dataJson[a]["F_DeviceSerialNumber"];
                var DeviceAttribute = _dataJson[a]["F_DeviceAttribute"];
                var DeviceState = _dataJson[a]["F_DeviceState"];
                var DeviceDescription = _dataJson[a]["F_DeviceDescription"];
                //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                if (DeviceName == ""||DeviceName == null) {
                    if (ABName.indexOf("车号") != -1) {
                        var Root = graph.insertVertex(parent, 'Root', ABName, w / 2 - 30, 20, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                        graph.updateCellSize(Root);
                        if (State == 0) {
                            addOverlaysInfo(graph, Root, 2, ABName, Description);
                            var RootLabel = graph.insertVertex(Root, null, '状态：' + "故障", 0, 0.9, 0, 0, null, true);
                        }
                        else if (State == 1) {
                            addOverlaysInfo(graph, Root, 1, ABName, Description);
                            var RootLabel = graph.insertVertex(Root, null, '状态：' + "正常", 0, 0.9, 0, 0, null, true);
                        }
                    }
                    else if (ABName.indexOf("CPS") != -1) {//CPS信息
                        var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                        graph.updateCellSize(Root);
                    }
                    else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                        continue;
                        var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                        graph.updateCellSize(Root);
                    }
                    else if (ABName.indexOf("天线") != -1) {//天线信息
                        continue;
                        var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                        graph.updateCellSize(Root);
                    }
                    else if (ABName.indexOf("灯光") != -1) {//灯光信息
                        continue;
                        var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Light.png');
                        graph.updateCellSize(Root);
                    }
                    else if (ABName.indexOf("相机") != -1) {//相机信息
                        continue;
                        var Root = graph.insertVertex(parent, 'Root', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Camera.png');
                        graph.updateCellSize(Root);
                    }
                    else {
                        var Root = graph.insertVertex(parent, 'Root', ABName, w / 2 - 30, 20, 130, 80);
                        graph.updateCellSize(Root);
                    }
                }
                else {
                }
                //下1级
                if (_dataJson[a].lstJsonDeviceTreeInfoChildren.length > 0) {
                    //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren.length);//获取子节点大小
                    for (var b = 0; b < _dataJson[a].lstJsonDeviceTreeInfoChildren.length; b++) {
                        LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b]["F_LevelMarkID"];
                        ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b]["F_ABName"];
                        State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b]["F_State"];
                        Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b]["F_Description"];
                        DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b]["F_DeviceName"];
                        DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b]["F_DeviceSerialNumber"];
                        DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b]["F_DeviceAttribute"];
                        DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b]["F_DeviceState"];
                        DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b]["F_DeviceDescription"];
                        //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                        if (DeviceName == ""||DeviceName == null) {
                            if (ABName.indexOf("车号") != -1) {
                                var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                graph.updateCellSize(Child1);
                                if (State == 0) {
                                    addOverlaysInfo(graph, Child1, 2, ABName, Description);
                                    var RootLabel = graph.insertVertex(Child1, null, '状态：' + "故障", 0, 0.9, 0, 0, null, true);
                                }
                                else if (State == 1) {
                                    addOverlaysInfo(graph, Child1, 1, ABName, Description);
                                    var RootLabel = graph.insertVertex(Child1, null, '状态：' + "正常", 0, 0.9, 0, 0, null, true);
                                }
                            }
                            else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                graph.updateCellSize(Child1);
                            }
                            else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                continue;
                                var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                graph.updateCellSize(Child1);
                            }
                            else if (ABName.indexOf("天线") != -1) {//天线信息
                                continue;
                                var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                                graph.updateCellSize(Child1);
                            }
                            else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                continue;
                                var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Light.png');
                                graph.updateCellSize(Child1);
                            }
                            else if (ABName.indexOf("相机") != -1) {//相机信息
                                continue;
                                var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                                graph.updateCellSize(Child1);
                            }
                            else {
                                var Child1 = graph.insertVertex(parent, 'Child1', ABName, 0, 0, 130, 80);
                                graph.updateCellSize(Child1);
                            }
                        }
                        else {
                        }
                        graph.insertEdge(parent, null, '', Root, Child1);//添加连线
                        //下2级
                        if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren.length) {
                            //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren.length);//获取子节点大小
                            for (var c = 0; c < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren.length; c++) {
                                LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c]["F_LevelMarkID"];
                                ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c]["F_ABName"];
                                State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c]["F_State"];//状态
                                Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c]["F_Description"];//描述
                                DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c]["F_DeviceName"];
                                DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c]["F_DeviceSerialNumber"];
                                DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c]["F_DeviceAttribute"];
                                DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c]["F_DeviceState"];
                                DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c]["F_DeviceDescription"];
                                //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                                if (DeviceName == ""||DeviceName == null) {
                                    if (ABName.indexOf("车号") != -1) {
                                        var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                        graph.updateCellSize(Child2);
                                        if (State == 0) {
                                            addOverlaysInfo(graph, Child2, 2, ABName, Description);
                                            var RootLabel = graph.insertVertex(Child2, null, '状态：' + "故障", 0, 0.9, 0, 0, null, true);
                                        }
                                        else if (State == 1) {
                                            addOverlaysInfo(graph, Child2, 1, ABName, Description);
                                            var RootLabel = graph.insertVertex(Child2, null, '状态：' + "正常", 0, 0.9, 0, 0, null, true);
                                        }
                                    }
                                    else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                        var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                        addOverlaysInfo(graph, Child2, 1, ABName, Description);
                                    }
                                    else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                        continue;
                                        var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                        graph.updateCellSize(Child2);
                                    }
                                    else if (ABName.indexOf("天线") != -1) {//天线信息
                                        continue;
                                        var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Ant.png');
                                        graph.updateCellSize(Child2);
                                    }
                                    else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                        continue;
                                        var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Light.png');
                                        graph.updateCellSize(Child2);
                                    }
                                    else if (ABName.indexOf("相机") != -1) {//相机信息
                                        continue;
                                        var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Camera.png');
                                        graph.updateCellSize(Child2);
                                    }
                                    else {
                                        var Child2 = graph.insertVertex(parent, 'Child2', ABName, 0, 0, 130, 80);
                                        graph.updateCellSize(Child2);
                                    }
                                }
                                else {
                                }
                                graph.insertEdge(parent, null, '', Child1, Child2);//添加连线
                                //下3级
                                if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren.length) {
                                    //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren.length);
                                    for (var d = 0; d < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren.length; d++) {
                                        LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d]["F_LevelMarkID"];
                                        ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d]["F_ABName"];
                                        State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d]["F_State"];
                                        Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d]["F_Description"];
                                        DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d]["F_DeviceName"];
                                        DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d]["F_DeviceSerialNumber"];
                                        DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d]["F_DeviceAttribute"];
                                        DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d]["F_DeviceState"];
                                        DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d]["F_DeviceDescription"];
                                        //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                                        if (DeviceName == ""||DeviceName == null) {
                                            if (ABName.indexOf("车号") != -1) {//AEI信息
                                                var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                graph.updateCellSize(Child3);
                                                if (State == 0) {
                                                    addOverlaysInfo(graph, Child3, 2, ABName, Description);
                                                    var RootLabel = graph.insertVertex(Child3, null, '状态：' + "故障", 0, 0.9, 0, 0, null, true);
                                                }
                                                else if (State == 1) {
                                                    addOverlaysInfo(graph, Child3, 1, ABName, Description);
                                                    var RootLabel = graph.insertVertex(Child3, null, '状态：' + "正常", 0, 0.9, 0, 0, null, true);
                                                }
                                            }
                                            else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                                var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                graph.updateCellSize(Child3);
                                            }
                                            else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                                continue;
                                                var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                                graph.updateCellSize(Child3);
                                            }
                                            else if (ABName.indexOf("天线") != -1) {//天线信息
                                                continue;
                                                var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                                                graph.updateCellSize(Child3);
                                            }
                                            else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                                continue;
                                                var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Light.png');
                                                graph.updateCellSize(Child3);
                                            }
                                            else if (ABName.indexOf("相机") != -1) {//相机信息
                                                continue;
                                                var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                                                graph.updateCellSize(Child3);
                                            }
                                            else {
                                                var Child3 = graph.insertVertex(parent, 'Child3', ABName, 0, 0, 130, 80);
                                                graph.updateCellSize(Child3);
                                            }
                                        }
                                        else {
                                        }
                                        graph.insertEdge(parent, null, '', Child2, Child3);//添加连线
                                        //下4级
                                        if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren!=null&&_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren.length) {
                                            //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren.length);
                                            for (var e = 0; e < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren.length; e++) {
                                                LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e]["F_LevelMarkID"];
                                                ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e]["F_ABName"];
                                                State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e]["F_State"];
                                                Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e]["F_Description"];
                                                DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e]["F_DeviceName"];
                                                DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e]["F_DeviceSerialNumber"];
                                                DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e]["F_DeviceAttribute"];
                                                DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e]["F_DeviceState"];
                                                DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e]["F_DeviceDescription"];
                                                //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                                                if (DeviceName == ""||DeviceName == null) {
                                                    if (ABName.indexOf("车号") != -1) {//AEI信息
                                                        var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/AEI.png');
                                                        graph.updateCellSize(Child4);
                                                        if (State == 0) {
                                                            addOverlaysInfo(graph, Child4, 2, ABName, Description);
                                                            var RootLabel = graph.insertVertex(Child4, null, '状态：' + "故障", 0, 0.9, 0, 0, null, true);
                                                        }
                                                        else if (State == 1) {
                                                            addOverlaysInfo(graph, Child4, 1, ABName, Description);
                                                            var RootLabel = graph.insertVertex(Child4, null, '状态：' + "正常", 0, 0.9, 0, 0, null, true);
                                                        }
                                                    }
                                                    else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                                        var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/CPS.png');
                                                        graph.updateCellSize(Child4);
                                                    }
                                                    else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                                        continue;
                                                        var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Mag.png');
                                                        graph.updateCellSize(Child4);
                                                    }
                                                    else if (ABName.indexOf("天线") != -1) {//天线信息
                                                        continue;
                                                        var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Ant.png');
                                                        graph.updateCellSize(Child4);
                                                    }
                                                    else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                                        continue;
                                                        var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Light.png');
                                                        graph.updateCellSize(Child4);
                                                    }
                                                    else if (ABName.indexOf("相机") != -1) {//相机信息
                                                        continue;
                                                        var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80, 'image=/Media/skin1/mxgraph/src/images/Camera.png');
                                                        graph.updateCellSize(Child4);
                                                    }
                                                    else {
                                                        var Child4 = graph.insertVertex(parent, 'Child4', ABName, 0, 0, 130, 80);
                                                        graph.updateCellSize(Child4);
                                                    }
                                                }
                                                else {
                                                }
                                                graph.insertEdge(parent, null, '', Child3, Child4);//添加连线
                                                //下5级
                                                if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren!=null&&_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren.length) {
                                                    //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren.length);
                                                    for (var f = 0; f < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren.length; f++) {
                                                        LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f]["F_LevelMarkID"];
                                                        ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f]["F_ABName"];
                                                        State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f]["F_State"];
                                                        Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f]["F_Description"];
                                                        DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f]["F_DeviceName"];
                                                        DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f]["F_DeviceSerialNumber"];
                                                        DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f]["F_DeviceAttribute"];
                                                        DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f]["F_DeviceState"];
                                                        DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f]["F_DeviceDescription"];
                                                        //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                                                        if (DeviceName == ""||DeviceName == null) {
                                                            if (ABName.indexOf("车号") != -1) {//AEI信息
                                                                var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                                graph.updateCellSize(Child5);
                                                                if (State == 0) {
                                                                    addOverlaysInfo(graph, Child5, 2, ABName, Description);
                                                                    var RootLabel = graph.insertVertex(Child5, null, '状态：' + "故障", 0, 0.9, 0, 0, null, true);
                                                                }
                                                                else if (State == 1) {
                                                                    addOverlaysInfo(graph, Child5, 1, ABName, Description);
                                                                    var RootLabel = graph.insertVertex(Child5, null, '状态：' + "正常", 0, 0.9, 0, 0, null, true);
                                                                }
                                                            }
                                                            else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                                                var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                                graph.updateCellSize(Child5);
                                                            }
                                                            else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                                                continue;
                                                                var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                                                graph.updateCellSize(Child5);
                                                            }
                                                            else if (ABName.indexOf("天线") != -1) {//天线信息
                                                                continue;
                                                                var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                                                                graph.updateCellSize(Child5);
                                                            }
                                                            else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                                                continue;
                                                                var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Light.png');
                                                                graph.updateCellSize(Child5);
                                                            }
                                                            else if (ABName.indexOf("相机") != -1) {//相机信息
                                                                continue;
                                                                var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                                                                graph.updateCellSize(Child5);
                                                            }
                                                            else {
                                                                var Child5 = graph.insertVertex(parent, 'Child5', ABName, 0, 0, 130, 80);
                                                                graph.updateCellSize(Child5);
                                                            }
                                                        }
                                                        else {
                                                        }
                                                        graph.insertEdge(parent, null, '', Child4, Child5);//添加连线
                                                        //下6级
                                                        if (_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren!=null&&_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren.length) {
                                                            //alert(_dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren.length);
                                                            for (var g = 0; g < _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren.length; g++) {
                                                                LevelMarkID = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g]["F_LevelMarkID"];
                                                                ABName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g]["F_ABName"];
                                                                State = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g]["F_State"];
                                                                Description = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g]["F_Description"];
                                                                DeviceName = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g]["F_DeviceName"];
                                                                DeviceSerialNumber = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g]["F_DeviceSerialNumber"];
                                                                DeviceAttribute = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g]["F_DeviceAttribute"];
                                                                DeviceState = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g]["F_DeviceState"];
                                                                DeviceDescription = _dataJson[a].lstJsonDeviceTreeInfoChildren[b].lstJsonDeviceTreeInfoChildren[c].lstJsonDeviceTreeInfoChildren[d].lstJsonDeviceTreeInfoChildren[e].lstJsonDeviceTreeInfoChildren[f].lstJsonDeviceTreeInfoChildren[g]["F_DeviceDescription"];
                                                                //alert(LevelMarkID + "-" + ABName + "-" + DeviceName + "-" + DeviceSerialNumber + "-" + DeviceAttribute + "-" + DeviceDescription);

                                                                if (DeviceName == ""||DeviceName == null) {
                                                                    if (ABName.indexOf("车号") != -1) {//AEI信息
                                                                        var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/AEI.png');
                                                                        graph.updateCellSize(Child6);
                                                                        if (State == 0) {
                                                                            addOverlaysInfo(graph, Child6, 2, ABName, Description);
                                                                            var RootLabel = graph.insertVertex(Child6, null, '状态：' + "故障", 0, 0.9, 0, 0, null, true);
                                                                        }
                                                                        else if (State == 1) {
                                                                            addOverlaysInfo(graph, Child6, 1, ABName, Description);
                                                                            var RootLabel = graph.insertVertex(Child6, null, '状态：' + "正常", 0, 0.9, 0, 0, null, true);
                                                                        }
                                                                    }
                                                                    else if (ABName.indexOf("CPS") != -1) {//CPS信息
                                                                        var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/CPS.png');
                                                                        graph.updateCellSize(Child6);
                                                                    }
                                                                    else if (ABName.indexOf("磁钢") != -1) {//磁钢信息
                                                                        continue;
                                                                        var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Mag.png');
                                                                        graph.updateCellSize(Child6);
                                                                    }
                                                                    else if (ABName.indexOf("天线") != -1) {//天线信息
                                                                        continue;
                                                                        var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Ant.png');
                                                                        graph.updateCellSize(Child6);
                                                                    }
                                                                    else if (ABName.indexOf("灯光") != -1) {//灯光信息
                                                                        continue;
                                                                        var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Light.png');
                                                                        graph.updateCellSize(Child6);
                                                                    }
                                                                    else if (ABName.indexOf("相机") != -1) {//相机信息
                                                                        continue;
                                                                        var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80, 'image='+siteurl+'/public/plugins/operation/images/Camera.png');
                                                                        graph.updateCellSize(Child6);
                                                                    }
                                                                    else {
                                                                        var Child6 = graph.insertVertex(parent, 'Child6', ABName, 0, 0, 130, 80);
                                                                        graph.updateCellSize(Child6);
                                                                    }
                                                                }
                                                                else {
                                                                }
                                                                graph.insertEdge(parent, null, '', Child5, Child6);//添加连线
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }

            }
        }
    }
    finally {
        // 结束更新事务
        graph.getModel().endUpdate();
    }
}
